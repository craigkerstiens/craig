
<!DOCTYPE HTML>
<html>
<head>
	<meta name="google-site-verification" content="hKvGTVuUObK9oCHVB0Hg5jTgwRsTdGVZvpJfDJbwevY" />
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Simple database read scaling without sharding in rails - Craig Kerstiens </title>

<meta name="author" content="Craig Kerstiens"> 

<meta name="description" content="In an earlier post I provided a high level overview of sharding. Sharding while a very solid approach to scaling capacity versus simply only relying &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Craig Kerstiens" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Craig Kerstiens</a></h1>
<h4></h4>
<nav id="main-nav"><ul>
	<li><a href="/about/">About</a></li>
	<li><a href="/about/travel_wine.html">Travel & Wine</a></li>
	<li><a href="/recommendations">My Recommendations</a></li>
	<li><a href="/content">Top Content</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about/">About</a></li>
	<li><a href="/about/travel_wine.html">Travel & Wine</a></li>
	<li><a href="/recommendations">My Recommendations</a></li>
	<li><a href="/content">Top Content</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.craigkerstiens.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Simple Database Read Scaling Without Sharding in Rails</h2>
	<div class="sharing">
	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>

	</div>
	<div class="entry-content"><p>In an earlier post I provided a high level <a href="http://www.craigkerstiens.com/2012/11/30/sharding-your-database/">overview of sharding</a>. Sharding while a very solid approach to scaling capacity versus simply only relying on vertical scaling can also be a time intensive one. Additionally in some cases certain sites may only need extra capacity for a short lived period of time. Fortunately theres a nice middle ground alternative for scaling capacity that works well in quite a few cases. It even has a benefit that can potentially in place of sharding.</p>

<p>This method results in scaling your reads to replica databases, you can do this on Heroku by taking advantage of followers. A follower is a read only database on Heroku Postgres that receives asynchronous updates of your data usually only lagging a very few commits behind. This means you can write all of your data to the leader (main) database, and then read from another.</p>

<p><em>While you can arbitrarily do this there&rsquo;s some major benefits to doing it based on the models. This is because Postgres maintains a cache on each instance its running on. Though you may have the same dataset, Postgres maintains frequently accessed or queried data in the cache giving you better performance. For more on this you can read earlier posts on <a href="http://www.craigkerstiens.com/2012/11/30/sharding-your-database/">PostgreSQL Performance</a>.</em></p>

<h3>Setting it up with Rails</h3>

<p>With a follower database created you can begin adding support for this to your application. The first thing is to add the gem to your Gemfile:</p>

<pre><code>gem 'ar-octopus', :require =&gt; "octopus"
</code></pre>

<p>Then of course to install it with <code>bundle install</code>. Now we can actually begin to add the code needed to have specific models access the follower.</p>

<pre><code>octopus:
shards:
  shard_sqlite:
  adapter: sqlite3
  database: db/db_one.sqlite3
  pool: 5
  timeout: 5000

  shard_pgsql:
    adapter: postgresql
    username: postgres
    password:
    database: db_two
    encoding: unicode
</code></pre>

<p>a</p>

<pre><code>class Project &lt; ActiveRecord::Base
  octopus_establish_connection(:adapter =&gt; "sqlite3", :database =&gt; "db_one")
end
</code></pre>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-03-06T00:00:00-08:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/categories/database/'>Database</a>, <a class='category' href='/categories/rails/'>Rails</a>, <a class='category' href='/categories/ruby/'>Ruby</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Craig Kerstiens

</footer>
	<script src="/javascripts/slash.js"></script>
<!--<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>  Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
		_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
		_gaq.push(['_setAccount', 'UA-4670852-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
